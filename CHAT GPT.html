<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BROWSER</title>
<style>
:root{
  --bg-dark:#071018; --panel-dark:#0b1418; --text:#e6eef6; --muted:#9fb0b6; --accent:#6de0b6;
  --bg-light:#f4f6f8; --panel-light:#ffffff; --text-light:#072226; --muted-light:#6b7b83;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Tahoma,system-ui;transition:background .2s,color .2s}
.app{display:flex;flex-direction:column;height:100%}
.header{display:flex;gap:8px;align-items:center;padding:10px;border-bottom:1px solid rgba(0,0,0,0.06)}
.brand{font-weight:900;font-size:18px;margin-left:10px}
.controls{display:flex;gap:8px;flex:1;align-items:center}
.inputWrap{display:flex;gap:8px;flex:1}
.input{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.08);font-size:15px}
.btn{padding:10px 12px;border-radius:10px;border:none;background:var(--accent);color:#012;font-weight:800;cursor:pointer}
.ghost{background:transparent;border:1px solid rgba(0,0,0,0.06);color:inherit}
.select{padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:transparent}

.container{display:flex;flex:1;gap:12px;padding:12px;overflow:hidden}
.left{flex:1;display:flex;flex-direction:column;gap:10px}
.view{flex:1;border-radius:10px;overflow:hidden;border:1px solid rgba(0,0,0,0.06);background: #0b1216; display:flex;align-items:center;justify-content:center}
.side{width:300px;max-width:40vw;display:flex;flex-direction:column;gap:10px}
.card{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);overflow:auto}
.small{font-size:13px;color:var(--muted)}
.list{max-height:45vh;overflow:auto;padding:0;margin:8px 0 0 0;list-style:none}
.item{padding:8px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.02);cursor:pointer}
.item:hover{background:rgba(255,255,255,0.03)}
.footer{padding:8px;text-align:center;font-size:13px;color:var(--muted)}
/* light theme */
.light body, .light .header, .light .card { background:var(--bg-light); color:var(--text-light); }
.light .input{border:1px solid rgba(0,0,0,0.08); background:var(--panel-light); color:var(--text-light)}
.light .brand{color:var(--text-light)}
.light .small{color:var(--muted-light)}
.light .view{background:#fff;border:1px solid rgba(0,0,0,.06)}
/* dark theme (default) */
:root{color-scheme:dark}
body { background:var(--bg-dark); color:var(--text); }
.header, .card { background:var(--panel-dark); color:var(--text); }
.input { background: #07121a; color:var(--text); }

/* responsive */
@media (max-width:880px){
  .container{flex-direction:column}
  .side{width:100%;max-height:35vh}
}
</style>
</head>
<body>
<div class="app" id="app">
  <div class="header">
    <div class="brand">BROWSER</div>
    <div class="controls">
      <div class="inputWrap">
        <input id="q" class="input" placeholder="آدرس یا عبارت را بنویس — مثال: example.com یا 'چطوری کد بزنم'">
        <select id="engine" class="select" title="انتخاب موتور">
          <option value="https://duckduckgo.com/?q=">DuckDuckGo (پیش‌فرض)</option>
          <option value="https://www.google.com/search?q=">Google</option>
          <option value="https://www.bing.com/search?q=">Bing</option>
        </select>
        <button id="go" class="btn">Search</button>
      </div>

      <button id="openNew" class="btn ghost">باز در تب جدید</button>
      <button id="bookmark" class="btn ghost">☆</button>
      <button id="theme" class="btn ghost">تم</button>
    </div>
  </div>

  <div class="container">
    <div class="left">
      <div class="view card" id="view">
        <div style="text-align:center;color:var(--muted)">
          <h2>مرورگر ساده</h2>
          <div class="small">آدرس وارد کن یا هر چیزی بپرس — وقتی Search زدی، نتایج در تب جدید باز می‌شوند (نمایش کامل سایت). تاریخچه، بوکمارک و تنظیمات ذخیره می‌شوند.</div>
        </div>
      </div>

      <div style="display:flex;gap:8px">
        <button id="historyBtn" class="btn ghost">تاریخچه</button>
        <button id="bookmarksBtn" class="btn ghost">بوکمارک‌ها</button>
        <div style="flex:1"></div>
        <div class="small">جستجو با موتور انتخابی انجام می‌شود — نرم و ساده</div>
      </div>
    </div>

    <aside class="side">
      <div class="card">
        <div class="small"><strong>تنظیمات</strong></div>
        <div style="margin-top:8px" class="small">
          <label><input type="checkbox" id="openInTab"> همیشه در تب جدید باز کن</label>
        </div>
        <div style="margin-top:8px">
          <div class="small">موتور پیش‌فرض و تم در localStorage ذخیره می‌شود.</div>
        </div>
      </div>

      <div class="card">
        <div class="small"><strong>بوکمارک‌ها</strong></div>
        <ul id="bookmarks" class="list"></ul>
        <div style="margin-top:8px">
          <button id="clearBookmarks" class="btn ghost">پاک کردن تمام بوکمارک‌ها</button>
        </div>
      </div>

      <div class="card">
        <div class="small"><strong>تاریخچه</strong></div>
        <ul id="history" class="list"></ul>
        <div style="margin-top:8px">
          <button id="clearHistory" class="btn ghost">پاک کردن تاریخچه</button>
        </div>
      </div>
    </aside>
  </div>

  <div class="footer small">نسخهٔ سادهٔ BROWSER — این برنامه خودش اینترنت را کرال نمی‌کند؛ فقط برای جستجو از موتورهای موجود استفاده می‌کند.</div>
</div>

<script>
/* ======= ذخیره و مقداردهی اولیه ======= */
const q = document.getElementById('q');
const go = document.getElementById('go');
const engine = document.getElementById('engine');
const openNew = document.getElementById('openNew');
const bookmarkBtn = document.getElementById('bookmark');
const themeBtn = document.getElementById('theme');
const view = document.getElementById('view');
const bookmarksEl = document.getElementById('bookmarks');
const historyEl = document.getElementById('history');
const clearBookmarks = document.getElementById('clearBookmarks');
const clearHistory = document.getElementById('clearHistory');
const openInTab = document.getElementById('openInTab');
const historyBtn = document.getElementById('historyBtn');
const bookmarksBtn = document.getElementById('bookmarksBtn');

const LS_THEME = 'browser_theme_v1';
const LS_BKM = 'browser_bookmarks_v1';
const LS_HISTORY = 'browser_history_v1';
const LS_ENGINE = 'browser_engine_v1';
const LS_OPENINTAB = 'browser_openintab_v1';

let theme = localStorage.getItem(LS_THEME) || 'dark';
let bookmarks = JSON.parse(localStorage.getItem(LS_BKM) || '[]');
let historyList = JSON.parse(localStorage.getItem(LS_HISTORY) || '[]');
let openTabPref = JSON.parse(localStorage.getItem(LS_OPENINTAB) || 'false');
openInTab.checked = openTabPref;

engine.value = localStorage.getItem(LS_ENGINE) || engine.value;

/* ======= تم ======= */
function applyTheme(){
  const root = document.documentElement;
  if(theme === 'light'){ root.classList.add('light'); } else { root.classList.remove('light'); }
}
themeBtn.onclick = ()=>{
  theme = (theme==='dark')? 'light' : 'dark';
  localStorage.setItem(LS_THEME, theme);
  applyTheme();
};
applyTheme();

/* ======= رندر بوکمارک و تاریخچه ======= */
function renderBookmarks(){
  bookmarksEl.innerHTML = bookmarks.length ? bookmarks.map(u=>`<li class="item" onclick="openUrl('${escapeHtml(u)}')">${escapeHtml(u)}</li>`).join('') : '<div class="small">بوکمارکی نیست</div>';
}
function renderHistory(){
  historyEl.innerHTML = historyList.length ? historyList.slice().reverse().map(u=>`<li class="item" onclick="openUrl('${escapeHtml(u.q)}')">${escapeHtml(u.q)} <div class="small">${new Date(u.t).toLocaleString()}</div></li>`).join('') : '<div class="small">تاریخچه خالی است</div>';
}
renderBookmarks();
renderHistory();

/* ======= کمکی ها ======= */
function escapeHtml(s){ return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;"); }
function saveAll(){ localStorage.setItem(LS_BKM, JSON.stringify(bookmarks)); localStorage.setItem(LS_HISTORY, JSON.stringify(historyList)); localStorage.setItem(LS_ENGINE, engine.value); localStorage.setItem(LS_OPENINTAB, JSON.stringify(openInTab.checked)); }

/* ======= باز کردن URL یا جستجو ======= */
function makeSearchUrl(qraw){
  let qv = (qraw||'').trim();
  if(!qv) return engine.value; // engine base
  if(/^https?:\/\//i.test(qv)) return qv;
  if(/\s/.test(qv)) return engine.value + encodeURIComponent(qv);
  if(/\.[a-z]{2,}$/i.test(qv)) return 'https://' + qv;
  return engine.value + encodeURIComponent(qv);
}

function openUrl(qraw){
  const url = makeSearchUrl(qraw);
  if(openInTab.checked || openTabPref){ // باز در تب جدید
    window.open(url, '_blank');
  } else {
    // سعی در نمایش داخل view (iframe-like) — ولی اکثر سایت‌ها iframe را مسدود می‌کنند.
    // ما برای نمایش کامل سایت، تب جدید را هم باز می‌کنیم تا مطمئن باشی می‌بینی.
    try{ view.innerHTML = `<iframe src="${url}" style="width:100%;height:100%;border:0"></iframe>`; }catch(e){}
    window.open(url, '_blank');
  }
  // ذخیره تاریخچه
  historyList.push({q: qraw, t: Date.now()});
  if(historyList.length>500) historyList.shift();
  saveAll(); renderHistory();
}

/* ======= رویدادها ======= */
go.onclick = ()=> openUrl(q.value);
q.addEventListener('keydown', e=>{ if(e.key==='Enter') go.click(); });
openNew.onclick = ()=> openUrl(q.value);
bookmarkBtn.onclick = ()=>{
  const v = (q.value||'').trim();
  if(!v) return alert('ابتدا آدرس یا عبارت را وارد کن');
  if(!bookmarks.includes(v)) bookmarks.push(v);
  saveAll(); renderBookmarks();
};
clearBookmarks.onclick = ()=> { if(confirm('همهٔ بوکمارک‌ها حذف شوند؟')){ bookmarks=[]; saveAll(); renderBookmarks(); } };
clearHistory.onclick = ()=> { if(confirm('تاریخچه پاک شود؟')){ historyList=[]; saveAll(); renderHistory(); } };
openInTab.addEventListener('change', ()=> { localStorage.setItem(LS_OPENINTAB, JSON.stringify(openInTab.checked)); });
engine.addEventListener('change', ()=> { localStorage.setItem(LS_ENGINE, engine.value); });

historyBtn.onclick = ()=> { alert('تاریخچه سمت راست نمایش داده می‌شود.'); }
bookmarksBtn.onclick = ()=> { alert('بوکمارک‌ها سمت راست نمایش داده می‌شوند.'); }

/* ======= helpers for inline onclick with escaped values ======= */
window.openUrl = openUrl;

/* ======= پایان ======= */
</script>
</body>
</html>